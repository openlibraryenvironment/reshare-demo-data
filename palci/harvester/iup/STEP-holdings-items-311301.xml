<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<transformationStep>
  <id>311301</id>
  <XmlTransformStep>
    <id>311301</id>
    <description>Holdings and Items, IUP</description>
    <enabled>true</enabled>
    <inputFormat>XML</inputFormat>
    <name>Holdings and Items, IUP</name>
    <outputFormat>XML</outputFormat>
    <script>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#xD;
&lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:marc=&quot;http://www.loc.gov/MARC21/slim&quot; xmlns:oai20=&quot;http://www.openarchives.org/OAI/2.0/&quot; version=&quot;1.0&quot;&gt;&#xD;
  &lt;xsl:strip-space elements=&quot;*&quot;/&gt;&#xD;
  &lt;xsl:output indent=&quot;yes&quot; method=&quot;xml&quot; version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;/&gt;&#xD;
  &lt;xsl:template match=&quot;collection&quot;&gt;&#xD;
    &lt;collection&gt;&#xD;
      &lt;xsl:apply-templates/&gt;&#xD;
    &lt;/collection&gt;&#xD;
  &lt;/xsl:template&gt;&#xD;
  &lt;xsl:template match=&quot;record&quot;&gt;&#xD;
    &lt;record&gt;&#xD;
      &lt;xsl:for-each select=&quot;@* | node()&quot;&gt;&#xD;
        &lt;xsl:copy-of select=&quot;.&quot;/&gt;&#xD;
      &lt;/xsl:for-each&gt;&#xD;
      &lt;xsl:apply-templates/&gt;&#xD;
    &lt;/record&gt;&#xD;
  &lt;/xsl:template&gt;&#xD;
  &lt;xsl:variable name=&quot;WILL_LEND&quot;&gt;46970b40-918e-47a4-a45d-b1677a2d3d46&lt;/xsl:variable&gt;&#xD;
  &lt;!-- FOLIO Inventory ILL Policy value &#39;Will lend&#39; --&gt;&#xD;
  &lt;xsl:variable name=&quot;WILL_NOT_LEND&quot;&gt;b0f97013-87f5-4bab-87f2-ac4a5191b489&lt;/xsl:variable&gt;&#xD;
  &lt;!-- FOLIO Inventory ILL Policy value &#39;Will not lend&#39; --&gt;&#xD;
  &lt;xsl:variable name=&quot;CNTYPE_DEWEY&quot;&gt;03dd64d0-5626-4ecd-8ece-4531e0069f35&lt;/xsl:variable&gt;&#xD;
  &lt;!-- Call number type: Dewey Decimal Classification  --&gt;&#xD;
  &lt;xsl:variable name=&quot;CNTYPE_LOC&quot;&gt;95467209-6d7b-468b-94df-0f5d7ad2747d&lt;/xsl:variable&gt;&#xD;
  &lt;!-- Call number type: LOC  --&gt;&#xD;
  &lt;xsl:variable name=&quot;CNTYPE_OTHER&quot;&gt;6caca63e-5651-4db6-9247-3205156e9699&lt;/xsl:variable&gt;&#xD;
  &lt;!-- Call number type: Other (catch unmapped)  --&gt;&#xD;
  &lt;xsl:variable name=&quot;CNTYPE_SUDOC&quot;&gt;fc388041-6cd0-4806-8a74-ebe3b9ab4c6e&lt;/xsl:variable&gt;&#xD;
  &lt;!-- Call number type: Other (catch unmapped)  --&gt;&#xD;
  &lt;xsl:template match=&quot;//marc:record&quot;&gt;&#xD;
    &lt;holdingsRecords&gt;&#xD;
      &lt;xsl:choose&gt;&#xD;
        &lt;xsl:when test=&quot;marc:datafield[@tag=&#39;900&#39; and @ind1!=&#39;4&#39; and @ind1!=&#39; &#39;]&quot;&gt;&#xD;
          &lt;arr&gt;&#xD;
            &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;900&#39; and @ind1!=&#39;4&#39; and @ind1!=&#39; &#39;]&quot;&gt;&#xD;
              &lt;xsl:variable name=&quot;holdingsId&quot; select=&quot;marc:subfield[@code=&#39;8&#39;]&quot;/&gt;&#xD;
              &lt;i&gt;&#xD;
                &lt;formerIds&gt;&#xD;
                  &lt;arr&gt;&#xD;
                    &lt;i&gt;&#xD;
                      &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;8&#39;]&quot;/&gt;&#xD;
                    &lt;/i&gt;&#xD;
                  &lt;/arr&gt;&#xD;
                &lt;/formerIds&gt;&#xD;
                &lt;xsl:variable name=&quot;LOC&quot; select=&quot;marc:subfield[@code=&#39;c&#39;]&quot;/&gt;&#xD;
                &lt;illPolicyId&gt;&#xD;
                  &lt;xsl:choose&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;SHAFER&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZII&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZIT&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZIO&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI1&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI2&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;GNOV&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;ETD&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZIQ&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;CIRCMUSIC&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;LDC&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;LDN&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;MUSRES&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;UNASSIGNED&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZISer&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI0&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI9&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI4&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;CIRMEDIA&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;DEAN&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;SPECCOLL&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;NPC&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PXYRES&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI5&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;PZI6&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;ILL&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;IN_RS_REQ&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;None&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;OUT_RS_REQ&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:when test=&quot;$LOC=&#39;ResourceLocated&#39;&quot;&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:when&gt;&#xD;
                    &lt;xsl:otherwise&gt;&#xD;
                      &lt;xsl:value-of select=&quot;$WILL_NOT_LEND&quot;/&gt;&#xD;
                    &lt;/xsl:otherwise&gt;&#xD;
                  &lt;/xsl:choose&gt;&#xD;
                &lt;/illPolicyId&gt;&#xD;
                &lt;permanentLocationIdHere&gt;&#xD;
                  &lt;xsl:value-of select=&quot;$LOC&quot;/&gt;&#xD;
                &lt;/permanentLocationIdHere&gt;&#xD;
                &lt;callNumber&gt;&#xD;
                  &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;f&#39;]&quot;&gt;&#xD;
                    &lt;xsl:if test=&quot;position() &amp;gt; 1&quot;&gt;&#xD;
                      &lt;xsl:text&gt; &lt;/xsl:text&gt;&#xD;
                    &lt;/xsl:if&gt;&#xD;
                    &lt;xsl:value-of select=&quot;.&quot;/&gt;&#xD;
                  &lt;/xsl:for-each&gt;&#xD;
                &lt;/callNumber&gt;&#xD;
                &lt;xsl:for-each select=&quot;../marc:datafield[@tag=&#39;995&#39;]&quot;&gt;&#xD;
                  &lt;xsl:if test=&quot;marc:subfield[@code=&#39;ff&#39;]=$holdingsId&quot;&gt;&#xD;
                    &lt;callNumberTypeId&gt;&#xD;
                      &lt;xsl:variable name=&quot;CNTYPE&quot; select=&quot;marc:subfield[@code=&#39;j&#39;]&quot;/&gt;&#xD;
                      &lt;xsl:choose&gt;&#xD;
                        &lt;xsl:when test=&quot;$CNTYPE=&#39;0&#39;&quot;&gt;&#xD;
                          &lt;xsl:value-of select=&quot;$CNTYPE_LOC&quot;/&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;$CNTYPE=&#39;1&#39;&quot;&gt;&#xD;
                          &lt;xsl:value-of select=&quot;$CNTYPE_DEWEY&quot;/&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;$CNTYPE=&#39;3&#39;&quot;&gt;&#xD;
                          &lt;xsl:value-of select=&quot;$CNTYPE_SUDOC&quot;/&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;$CNTYPE=&#39;8&#39;&quot;&gt;&#xD;
                          &lt;xsl:value-of select=&quot;$CNTYPE_OTHER&quot;/&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                      &lt;/xsl:choose&gt;&#xD;
                    &lt;/callNumberTypeId&gt;&#xD;
                  &lt;/xsl:if&gt;&#xD;
                &lt;/xsl:for-each&gt;&#xD;
                &lt;items&gt;&#xD;
                  &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;../marc:datafield[@tag=&#39;995&#39;]&quot;&gt;&#xD;
                      &lt;xsl:if test=&quot;marc:subfield[@code=&#39;ff&#39;]=$holdingsId&quot;&gt;&#xD;
                        &lt;i&gt;&#xD;
                          &lt;itemIdentifier&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                          &lt;/itemIdentifier&gt;&#xD;
                          &lt;barcode&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;s&#39;]&quot;/&gt;&#xD;
                          &lt;/barcode&gt;&#xD;
                          &lt;permanentLoanTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe27&lt;/permanentLoanTypeId&gt;&#xD;
                          &lt;!-- Can circulate --&gt;&#xD;
                          &lt;materialTypeId&gt;&#xD;
                            &lt;!-- Mappings to ReShare specific material types, taken from OCLC table &quot;Type of Record&quot; --&gt;&#xD;
                            &lt;xsl:choose&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;BOOK&#39;&quot;&gt;e65ed344-a691-4f8f-8446-3c0a346c6882&lt;/xsl:when&gt;&#xD;
                              &lt;!-- BKS --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;ELEC&#39;&quot;&gt;22cb5b81-2056-46ed-8050-c5d8f01caf90&lt;/xsl:when&gt;&#xD;
                              &lt;!-- COM --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;ISSUE&#39;&quot;&gt;191da404-dec2-4977-9770-1443d9d6c238&lt;/xsl:when&gt;&#xD;
                              &lt;!-- CNR --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;MANUSCRIPT&#39;&quot;&gt;e65ed344-a691-4f8f-8446-3c0a346c6882&lt;/xsl:when&gt;&#xD;
                              &lt;!-- BKS --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;MAP&#39;&quot;&gt;9f2c8d85-97e6-4722-a67c-bb51ccfb7781&lt;/xsl:when&gt;&#xD;
                              &lt;!-- MAP --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;OTHER&#39;&quot;&gt;04858422-c46f-4041-94fc-f5c5a6b98319&lt;/xsl:when&gt;&#xD;
                              &lt;!-- Other --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;SCORE&#39;&quot;&gt;e5578a7e-49b9-4859-a86a-21b812215b4f&lt;/xsl:when&gt;&#xD;
                              &lt;!-- SCO --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;RECORD&#39;&quot;&gt;d8dc9046-a9f4-4789-adf5-678fd855b016&lt;/xsl:when&gt;&#xD;
                              &lt;!-- REC --&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;t&#39;]=&#39;DVD&#39;&quot;&gt;14f1845d-2fad-4091-80c8-48614eaea40b&lt;/xsl:when&gt;&#xD;
                              &lt;!-- VIS --&gt;&#xD;
                              &lt;xsl:otherwise&gt;f6dd0721-5d4a-439e-9205-c71aef39d15b&lt;/xsl:otherwise&gt;&#xD;
                              &lt;!-- Unmapped --&gt;&#xD;
                            &lt;/xsl:choose&gt;&#xD;
                          &lt;/materialTypeId&gt;&#xD;
                          &lt;status&gt;&#xD;
                            &lt;name&gt;Unknown&lt;/name&gt;&#xD;
                          &lt;/status&gt;&#xD;
                          &lt;enumeration&gt;&#xD;
                            &lt;xsl:choose&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;w&#39;]&quot;&gt;&#xD;
                                &lt;xsl:value-of select=&quot;concat(marc:subfield[@code=&#39;e&#39;], &#39; &#39;, marc:subfield[@code=&#39;w&#39;])&quot;/&gt;&#xD;
                              &lt;/xsl:when&gt;&#xD;
                              &lt;xsl:otherwise&gt;&#xD;
                                &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;e&#39;]&quot;/&gt;&#xD;
                              &lt;/xsl:otherwise&gt;&#xD;
                            &lt;/xsl:choose&gt;&#xD;
                          &lt;/enumeration&gt;&#xD;
                          &lt;chronology&gt;&#xD;
                            &lt;xsl:choose&gt;&#xD;
                              &lt;xsl:when test=&quot;marc:subfield[@code=&#39;x&#39;]&quot;&gt;&#xD;
                                &lt;xsl:value-of select=&quot;concat(marc:subfield[@code=&#39;f&#39;], &#39; &#39;, marc:subfield[@code=&#39;x&#39;])&quot;/&gt;&#xD;
                              &lt;/xsl:when&gt;&#xD;
                              &lt;xsl:otherwise&gt;&#xD;
                                &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;f&#39;]&quot;/&gt;&#xD;
                              &lt;/xsl:otherwise&gt;&#xD;
                            &lt;/xsl:choose&gt;&#xD;
                          &lt;/chronology&gt;&#xD;
                        &lt;/i&gt;&#xD;
                      &lt;/xsl:if&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                  &lt;/arr&gt;&#xD;
                &lt;/items&gt;&#xD;
              &lt;/i&gt;&#xD;
            &lt;/xsl:for-each&gt;&#xD;
          &lt;/arr&gt;&#xD;
        &lt;/xsl:when&gt;&#xD;
        &lt;xsl:otherwise&gt;&#xD;
          &lt;arr&gt;&#xD;
            &lt;i&gt;&#xD;
              &lt;permanentLocationIdHere/&gt;&#xD;
            &lt;/i&gt;&#xD;
          &lt;/arr&gt;&#xD;
        &lt;/xsl:otherwise&gt;&#xD;
      &lt;/xsl:choose&gt;&#xD;
    &lt;/holdingsRecords&gt;&#xD;
  &lt;/xsl:template&gt;&#xD;
  &lt;xsl:template match=&quot;text()&quot;/&gt;&#xD;
&lt;/xsl:stylesheet&gt;&#xD;
</script>
    <testData></testData>
    <testOutput></testOutput>
  </XmlTransformStep>
</transformationStep>
