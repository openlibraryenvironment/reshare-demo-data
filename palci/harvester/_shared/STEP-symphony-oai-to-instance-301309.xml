<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<transformationStep uri="http://harvester.folio-dev-us-east-1-1.folio-dev.indexdata.com/harvester/records/steps/10101">
  <id>301309</id>
  <XmlTransformStep>
    <id>301309</id>
    <description>Transforms from Sirsi Symphony OAI response with a marc21 namespace to marc namespace</description>
    <inputFormat>xml</inputFormat>
    <name>Symphony MARC21 to Instance</name>
    <outputFormat>xml</outputFormat>
    <script>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#13;
&lt;xsl:stylesheet&#13;
    version="1.0"&#13;
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&#13;
    xmlns:marc21="http://www.openarchives.org/OAI/2.0/marc21/"&#13;
    xmlns:marc="http://www.loc.gov/MARC21/slim"&#13;
    xmlns:oai20="http://www.openarchives.org/OAI/2.0/"&gt;&#13;
&#13;
    &lt;xsl:import href="map-relator-to-contributor-type.xsl"/&gt;&#13;
    &#13;
    &lt;xsl:output indent="yes" method="xml" version="1.0" encoding="UTF-8"/&gt;&#13;
    &lt;xsl:template match="/"&gt;&#13;
        &lt;collection xmlns:marc="http://www.loc.gov/MARC21/slim" xmlns:oai20="http://www.openarchives.org/OAI/2.0/"&gt;&#13;
            &lt;xsl:apply-templates /&gt;&#13;
        &lt;/collection&gt;&#13;
    &lt;/xsl:template&gt;&#13;
&#13;
    &lt;xsl:template match="oai20:record"&gt;&#13;
      &lt;record&gt;&#13;
        &lt;xsl:choose&gt;&#13;
          &lt;xsl:when test="oai20:header[@status='deleted']"&gt;&#13;
             &lt;xsl:apply-templates/&gt;&#13;
          &lt;/xsl:when&gt;&#13;
          &lt;xsl:otherwise&gt;  &#13;
            &lt;!-- Store the original MARC record to be used by subsequent style sheets --&gt;&#13;
            &lt;original&gt;&#13;
              &lt;record xmlns="http://www.openarchives.org/OAI/2.0/" &#13;
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#13;
                    xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"&gt;&#13;
                &lt;xsl:copy-of select="//oai20:header"/&gt;&#13;
                &lt;metadata&gt;&#13;
                    &lt;record xmlns="http://www.loc.gov/MARC21/slim"&#13;
                    xsi:schemaLocation="http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd"&gt;&#13;
                        &lt;xsl:for-each select="//marc21:marc21/@* | //marc21:marc21/*"&gt; &#13;
                            &lt;xsl:element name="{local-name()}"&gt;&#13;
                                &lt;xsl:for-each select="@*"&gt;&#13;
                                    &lt;xsl:attribute name="{local-name()}"&gt;&#13;
                                        &lt;xsl:value-of select="."/&gt;&#13;
                                    &lt;/xsl:attribute&gt;&#13;
                                &lt;/xsl:for-each&gt;&#13;
                                &lt;xsl:choose&gt;&#13;
                                    &lt;xsl:when test="local-name()='leader' or local-name()='controlfield'"&gt;&#13;
                                        &lt;xsl:value-of select="."/&gt;&#13;
                                    &lt;/xsl:when&gt;&#13;
                                    &lt;xsl:otherwise&gt;&#13;
                                        &lt;xsl:for-each select="*"&gt;&#13;
                                            &lt;xsl:element name="{local-name()}"&gt;&#13;
                                                &lt;xsl:for-each select="@*"&gt;&#13;
                                                    &lt;xsl:attribute name="{local-name()}"&gt;&#13;
                                                        &lt;xsl:value-of select="."/&gt;&#13;
                                                    &lt;/xsl:attribute&gt;&#13;
                                                &lt;/xsl:for-each&gt;&#13;
                                                &lt;xsl:value-of select="."/&gt;&#13;
                                            &lt;/xsl:element&gt;&#13;
                                        &lt;/xsl:for-each&gt;&#13;
                                    &lt;/xsl:otherwise&gt;&#13;
                                &lt;/xsl:choose&gt;&#13;
                            &lt;/xsl:element&gt;&#13;
                        &lt;/xsl:for-each&gt;&#13;
                    &lt;/record&gt;&#13;
                &lt;/metadata&gt;&#13;
              &lt;/record&gt;            &#13;
            &lt;/original&gt;&#13;
            &lt;xsl:apply-templates/&gt;&#13;
          &lt;/xsl:otherwise&gt;&#13;
        &lt;/xsl:choose&gt;&#13;
      &lt;/record&gt;&#13;
    &lt;/xsl:template&gt; &#13;
&#13;
    &lt;!-- If this is an OAI-PMH deletion record --&gt;&#13;
    &lt;xsl:template match="//oai20:header[@status='deleted']"&gt;&#13;
        &lt;delete&gt;&#13;
            &lt;oaiIdentifier&gt;&lt;xsl:value-of select="oai20:identifier"/&gt;&lt;/oaiIdentifier&gt;&#13;
            &lt;identifierTypeIdHere/&gt;&#13;
            &lt;institutionIdHere/&gt;&#13;
        &lt;/delete&gt;&#13;
    &lt;/xsl:template&gt;&#13;
&#13;
    &lt;!-- MARC meta data --&gt;&#13;
    &lt;xsl:template match="//marc21:marc21"&gt;&#13;
&#13;
        &lt;!-- Information needed for storing source record in union catalog context --&gt;&#13;
        &lt;xsl:variable name="recnum" select="../../oai20:header/oai20:identifier"/&gt;&#13;
        &lt;institutionIdHere/&gt;&#13;
        &lt;localIdentifier&gt;&lt;xsl:value-of select="$recnum"/&gt;&lt;/localIdentifier&gt;&#13;
&#13;
        &lt;!-- Bibliographic record for FOLIO inventory --&gt;&#13;
        &lt;instance&gt;&#13;
            &lt;source&gt;MARC&lt;/source&gt;&#13;
&#13;
            &lt;!-- Instance type ID (resource type) --&gt;&#13;
            &lt;instanceTypeId&gt;&#13;
                &lt;!-- UUIDs for resource types --&gt;&#13;
                &lt;xsl:choose&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='a'"&gt;6312d172-f0cf-40f6-b27d-9fa8feaf332f&lt;/xsl:when&gt; &lt;!-- language material : text --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='c'"&gt;497b5090-3da2-486c-b57f-de5bb3c2e26d&lt;/xsl:when&gt; &lt;!-- notated music : notated music --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='d'"&gt;497b5090-3da2-486c-b57f-de5bb3c2e26d&lt;/xsl:when&gt; &lt;!-- manuscript notated music : notated music -&gt; notated music --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='e'"&gt;526aa04d-9289-4511-8866-349299592c18&lt;/xsl:when&gt; &lt;!-- cartographic material : cartographic image --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='f'"&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- other --&gt; &lt;!-- manuscript cartographic material : ? --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='g'"&gt;535e3160-763a-42f9-b0c0-d8ed7df6e2a2&lt;/xsl:when&gt; &lt;!-- projected image : still image --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='i'"&gt;9bce18bd-45bf-4949-8fa8-63163e4b7d7f&lt;/xsl:when&gt; &lt;!-- nonmusical sound recording : sounds --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='j'"&gt;3be24c14-3551-4180-9292-26a786649c8b&lt;/xsl:when&gt; &lt;!-- musical sound recording : performed music --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='k'"&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- other --&gt; &lt;!-- two-dimensional nonprojectable graphic : ?--&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='m'"&gt;df5dddff-9c30-4507-8b82-119ff972d4d7&lt;/xsl:when&gt; &lt;!-- computer file : computer dataset --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='o'"&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- kit : other --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='p'"&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- mixed material : other --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='r'"&gt;c1e95c2b-4efc-48cf-9e71-edb622cf0c22&lt;/xsl:when&gt; &lt;!-- three-dimensional artifact or naturally occurring object : three-dimensional form --&gt;&#13;
                &lt;xsl:when test="substring(oai20:leader,1,1)='t'"&gt;6312d172-f0cf-40f6-b27d-9fa8feaf332f&lt;/xsl:when&gt; &lt;!-- manuscript language material : text --&gt;&#13;
                &lt;xsl:otherwise&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:otherwise&gt;                             &lt;!--  : other --&gt;&#13;
                &lt;/xsl:choose&gt;&#13;
            &lt;/instanceTypeId&gt;&#13;
&#13;
            &lt;!-- Identifiers --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='010' or @tag='020' or @tag='022' or @tag='024' or @tag='028' or @tag='035' or @tag='074']&#13;
                        or oai20:controlfield[@tag='001']"&gt;&#13;
                &lt;identifiers&gt;&#13;
                &lt;arr&gt;&#13;
                &lt;xsl:for-each select="$recnum"&gt;&#13;
                    &lt;i&gt;&#13;
                    &lt;value&gt;&lt;xsl:value-of select="."/&gt;&lt;/value&gt;&#13;
                    &lt;!-- A subsequent library specific transformation (style sheet)&#13;
                        must replace this tag with the actual identifierTypeId for&#13;
                        the record identifer type of the given library --&gt;&#13;
                    &lt;identifierTypeIdHere/&gt;&#13;
                    &lt;/i&gt;&#13;
                &lt;/xsl:for-each&gt;&#13;
                &lt;xsl:for-each select="oai20:datafield[(@tag='001' or @tag='010' or @tag='020' or @tag='022' or @tag='024' or @tag='028' or @tag='035' or @tag='074') and normalize-space(./oai20:subfield[@code='a'])]"&gt;&#13;
                    &lt;i&gt;&#13;
                    &lt;xsl:choose&gt;&#13;
                        &lt;xsl:when test="current()[@tag='010'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;c858e4f2-2b6b-4385-842b-60732ee14abb&lt;/identifierTypeId&gt; &lt;!-- LCCN --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='020'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;8261054f-be78-422d-bd51-4ed9f33c3422&lt;/identifierTypeId&gt; &lt;!-- ISBN --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='022'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;913300b2-03ed-469a-8179-c1092c991227&lt;/identifierTypeId&gt; &lt;!-- ISSN --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='024'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;2e8b3b6c-0e7d-4e48-bca2-b0b23b376af5&lt;/identifierTypeId&gt; &lt;!-- Other standard identifier --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='028'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;b5d8cdc4-9441-487c-90cf-0c7ec97728eb&lt;/identifierTypeId&gt; &lt;!-- Publisher number --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='035'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;7e591197-f335-4afb-bc6d-a6d76ca3bace&lt;/identifierTypeId&gt; &lt;!-- System control number --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='074'] and oai20:subfield[@code='a']"&gt;&#13;
                        &lt;value&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/value&gt;&#13;
                        &lt;identifierTypeId&gt;351ebc1c-3aae-4825-8765-c6d50dbf011f&lt;/identifierTypeId&gt; &lt;!-- GPO item number --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                    &lt;/xsl:choose&gt;&#13;
                    &lt;/i&gt;&#13;
                &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/identifiers&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- Classifications --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='050' or @tag='060' or @tag='080' or @tag='082' or @tag='086' or @tag='090']"&gt;&#13;
                &lt;classifications&gt;&#13;
                &lt;arr&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='050' or @tag='060' or @tag='080' or @tag='082' or @tag='086' or @tag='090']"&gt;&#13;
                    &lt;i&gt;&#13;
                        &lt;xsl:choose&gt;&#13;
                        &lt;xsl:when test="current()[@tag='050']"&gt;&#13;
                            &lt;classificationNumber&gt;&#13;
                            &lt;xsl:for-each select="oai20:subfield[@code='a' or @code='b']"&gt;&#13;
                                &lt;xsl:if test="position() &gt; 1"&gt;&#13;
                                &lt;xsl:text&gt;; &lt;/xsl:text&gt;&#13;
                            &lt;/xsl:if&gt;&#13;
                            &lt;xsl:value-of select="."/&gt;&#13;
                            &lt;/xsl:for-each&gt;&#13;
                            &lt;/classificationNumber&gt;&#13;
                            &lt;classificationTypeId&gt;ce176ace-a53e-4b4d-aa89-725ed7b2edac&lt;/classificationTypeId&gt; &lt;!-- LC, Library of Congress --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='082']"&gt;&#13;
                            &lt;classificationNumber&gt;&#13;
                            &lt;xsl:for-each select="oai20:subfield[@code='a' or @code='b']"&gt;&#13;
                                &lt;xsl:if test="position() &gt; 1"&gt;&#13;
                                &lt;xsl:text&gt;; &lt;/xsl:text&gt;&#13;
                            &lt;/xsl:if&gt;&#13;
                            &lt;xsl:value-of select="."/&gt;&#13;
                            &lt;/xsl:for-each&gt;&#13;
                            &lt;/classificationNumber&gt;&#13;
                            &lt;classificationTypeId&gt;42471af9-7d25-4f3a-bf78-60d29dcf463b&lt;/classificationTypeId&gt; &lt;!-- Dewey --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="current()[@tag='086']"&gt;&#13;
                            &lt;classificationNumber&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                            &lt;/classificationNumber&gt;&#13;
                            &lt;classificationTypeId&gt;9075b5f8-7d97-49e1-a431-73fdd468d476&lt;/classificationTypeId&gt; &lt;!-- SUDOC --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;/xsl:choose&gt;&#13;
                    &lt;/i&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/classifications&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- title --&gt; &#13;
            &lt;title&gt;&#13;
                &lt;xsl:variable name="dirty-title"&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='245'][1]/oai20:subfield[@code='a' or @code='b' or @code='h' or @code='n' or @code='p']"&gt;&#13;
                        &lt;xsl:value-of select="."/&gt;&#13;
                        &lt;xsl:if test="position() != last()"&gt;&#13;
                            &lt;xsl:text&gt; &lt;/xsl:text&gt;&#13;
                        &lt;/xsl:if&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                &lt;/xsl:variable&gt;&#13;
                &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                    &lt;xsl:with-param  name="input" select="$dirty-title" /&gt;&#13;
                    &lt;xsl:with-param  name="characters"&gt;,-./ :;&lt;/xsl:with-param&gt;&#13;
                &lt;/xsl:call-template&gt;&#13;
            &lt;/title&gt;&#13;
&#13;
            &lt;!-- Contributors --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='100' or @tag='110' or @tag='111' or @tag='700' or @tag='710' or @tag='711']"&gt;&#13;
                &lt;contributors&gt;&#13;
                &lt;arr&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='100' or @tag='110' or @tag='111' or @tag='700' or @tag='710' or @tag='711']"&gt;&#13;
                    &lt;i&gt;&#13;
                        &lt;name&gt;&#13;
                        &lt;xsl:for-each select="oai20:subfield[@code='a' or @code='b' or @code='c' or @code='d' or @code='f' or @code='g' or @code='j' or @code='k' or @code='l' or @code='n' or @code='p' or @code='q' or @code='t' or @code='u']"&gt;&#13;
                        &lt;xsl:if test="position() &gt; 1"&gt;&#13;
                            &lt;xsl:text&gt;, &lt;/xsl:text&gt;&#13;
                        &lt;/xsl:if&gt;&#13;
                        &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                            &lt;xsl:with-param  name="input" select="." /&gt;&#13;
                            &lt;xsl:with-param  name="characters"&gt;,-.&lt;/xsl:with-param&gt;&#13;
                        &lt;/xsl:call-template&gt;&#13;
                        &lt;/xsl:for-each&gt;&#13;
                        &lt;/name&gt;&#13;
                        &lt;xsl:choose&gt;&#13;
                        &lt;xsl:when test="@tag='100' or @tag='700'"&gt;&#13;
                            &lt;contributorNameTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe2a&lt;/contributorNameTypeId&gt; &lt;!-- personal name --&gt;&#13;
                            &lt;xsl:if test="@tag='100'"&gt;&#13;
                            &lt;primary&gt;true&lt;/primary&gt;&#13;
                            &lt;/xsl:if&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="@tag='110' or @tag='710'"&gt;&#13;
                            &lt;contributorNameTypeId&gt;2e48e713-17f3-4c13-a9f8-23845bb210aa&lt;/contributorNameTypeId&gt; &lt;!-- corporate name --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:when test="@tag='111' or @tage='711'"&gt;&#13;
                            &lt;contributorNameTypeId&gt;e8b311a6-3b21-43f2-a269-dd9310cb2d0a&lt;/contributorNameTypeId&gt; &lt;!-- meeting name --&gt;&#13;
                        &lt;/xsl:when&gt;&#13;
                        &lt;xsl:otherwise&gt;&#13;
                            &lt;contributorNameTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe2a&lt;/contributorNameTypeId&gt; &lt;!-- personal name --&gt;&#13;
                        &lt;/xsl:otherwise&gt;&#13;
                        &lt;/xsl:choose&gt;&#13;
                        &lt;xsl:if test="oai20:subfield[@code='e' or @code='4']"&gt;&#13;
                        &lt;contributorTypeId&gt;&#13;
                            &lt;xsl:call-template name="map-relator"/&gt;&#13;
                        &lt;/contributorTypeId&gt;&#13;
                        &lt;/xsl:if&gt;&#13;
                    &lt;/i&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/contributors&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- Editions --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='250']"&gt;&#13;
                &lt;editions&gt;&#13;
                &lt;arr&gt;&#13;
                &lt;xsl:for-each select="oai20:datafield[@tag='250']"&gt;&#13;
                    &lt;i&gt;&#13;
                    &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                    &lt;xsl:if test="oai20:subfield[@code='b']"&gt;; &lt;xsl:value-of select="oai20:subfield[@code='b']"/&gt;&lt;/xsl:if&gt;&#13;
                    &lt;/i&gt;&#13;
                &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/editions&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- Publication --&gt;&#13;
            &lt;xsl:choose&gt;&#13;
                &lt;xsl:when test="oai20:datafield[@tag='260' or @tag='264']"&gt;&#13;
                &lt;publication&gt;&#13;
                    &lt;arr&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='260' or @tag='264']"&gt;&#13;
                        &lt;i&gt;&#13;
                        &lt;publisher&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='b']"/&gt;&#13;
                        &lt;/publisher&gt;&#13;
                        &lt;place&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='a']"/&gt;&#13;
                        &lt;/place&gt;&#13;
                        &lt;dateOfPublication&gt;&#13;
                            &lt;xsl:value-of select="oai20:subfield[@code='c']"/&gt;&#13;
                        &lt;/dateOfPublication&gt;&#13;
                        &lt;/i&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                    &lt;/arr&gt;&#13;
                &lt;/publication&gt;&#13;
                &lt;/xsl:when&gt;&#13;
                &lt;xsl:otherwise&gt;&#13;
                &lt;publication&gt;&#13;
                    &lt;arr&gt;&#13;
                    &lt;i&gt;&#13;
                        &lt;dateOfPublication&gt;&#13;
                        &lt;xsl:value-of select="substring(oai20:controlfield[@tag='008'],8,4)"/&gt;&#13;
                        &lt;/dateOfPublication&gt;&#13;
                    &lt;/i&gt;&#13;
                    &lt;/arr&gt;&#13;
                &lt;/publication&gt;&#13;
                &lt;/xsl:otherwise&gt;&#13;
            &lt;/xsl:choose&gt;&#13;
&#13;
            &lt;!-- physicalDescriptions --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='300']"&gt;&#13;
                &lt;physicalDescriptions&gt;&#13;
                &lt;arr&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='300']"&gt;&#13;
                    &lt;i&gt;&#13;
                        &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                        &lt;xsl:with-param  name="input" select="oai20:subfield[@code='a']" /&gt;&#13;
                        &lt;xsl:with-param  name="characters"&gt;,-./ :;&lt;/xsl:with-param&gt;&#13;
                        &lt;/xsl:call-template&gt;&#13;
                    &lt;/i&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/physicalDescriptions&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- Subjects --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='600' or @tag='610' or @tag='611' or @tag='630' or @tag='648' or @tag='650' or @tag='651' or @tag='653' or @tag='654' or @tag='655' or @tag='656' or @tag='657' or @tag='658' or @tag='662' or @tag='69X']"&gt;&#13;
                &lt;subjects&gt;&#13;
                &lt;arr&gt;&#13;
                &lt;xsl:for-each select="oai20:datafield[@tag='600' or @tag='610' or @tag='611' or @tag='630' or @tag='648' or @tag='650' or @tag='651' or @tag='653' or @tag='654' or @tag='655' or @tag='656' or @tag='657' or @tag='658' or @tag='662' or @tag='69X']"&gt;&#13;
                    &lt;i&gt;&#13;
                    &lt;xsl:for-each select="oai20:subfield[@code='a' or @code='b' or @code='c' or @code='d' or @code='f' or @code='g' or @code='j' or @code='k' or @code='l' or @code='n' or @code='p' or @code='q' or @code='t' or @code='u' or @code='v' or @code='x' or @code='y' or @code='z']"&gt;&#13;
                    &lt;xsl:if test="position() &gt; 1"&gt;&#13;
                        &lt;xsl:text&gt;--&lt;/xsl:text&gt;&#13;
                    &lt;/xsl:if&gt;&#13;
                    &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                        &lt;xsl:with-param  name="input" select="." /&gt;&#13;
                        &lt;xsl:with-param  name="characters"&gt;,-.&lt;/xsl:with-param&gt;&#13;
                        &lt;/xsl:call-template&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                    &lt;/i&gt;&#13;
                &lt;/xsl:for-each&gt;&#13;
                &lt;/arr&gt;&#13;
                &lt;/subjects&gt;&#13;
            &lt;/xsl:if&gt;&#13;
&#13;
            &lt;!-- Notes --&gt;&#13;
            &lt;xsl:if test="oai20:datafield[@tag='500' or @tag='504' or @tag='505' or @tag='520']"&gt;&#13;
                &lt;notes&gt;&#13;
                    &lt;arr&gt;&#13;
                    &lt;xsl:for-each select="oai20:datafield[@tag='500' or @tag='504' or @tag='505' or @tag='520']"&gt;&#13;
                        &lt;i&gt;&#13;
                            &lt;note&gt;&#13;
                                &lt;xsl:value-of select="normalize-space(.)"/&gt;&#13;
                            &lt;/note&gt;&#13;
                            &lt;instanceNoteTypeId&gt;&#13;
                                &lt;xsl:choose&gt;&#13;
                                    &lt;xsl:when test='./@tag="504"'&gt;86b6e817-e1bc-42fb-bab0-70e7547de6c1&lt;/xsl:when&gt; &lt;!-- biliography --&gt;&#13;
                                    &lt;xsl:when test='./@tag="505"'&gt;5ba8e385-0e27-462e-a571-ffa1fa34ea54&lt;/xsl:when&gt; &lt;!-- contents --&gt;&#13;
                                    &lt;xsl:when test='./@tag="520"'&gt;0e2e11b-450f-45c8-b09b-0f819999966e&lt;/xsl:when&gt; &lt;!-- contents --&gt;&#13;
                                    &lt;xsl:otherwise&gt;6a2533a7-4de2-4e64-8466-074c2fa9308c&lt;/xsl:otherwise&gt; &lt;!-- general --&gt;&#13;
                            &lt;/xsl:choose&gt;&#13;
                            &lt;/instanceNoteTypeId&gt;&#13;
                        &lt;/i&gt;&#13;
                    &lt;/xsl:for-each&gt;&#13;
                    &lt;/arr&gt;&#13;
                &lt;/notes&gt;&#13;
            &lt;/xsl:if&gt;&#13;
            &#13;
        &lt;/instance&gt;&#13;
&#13;
        &lt;!-- Additional info for creating match key in FOLIO Inventory match module --&gt;&#13;
        &lt;matchKey&gt;&#13;
            &lt;xsl:for-each select="oai20:datafield[@tag='245']"&gt;&#13;
            &lt;title&gt;&#13;
                &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                &lt;xsl:with-param  name="input" select="oai20:subfield[@code='a']" /&gt;&#13;
                &lt;xsl:with-param  name="characters"&gt;,-./ :;&lt;/xsl:with-param&gt;&#13;
                &lt;/xsl:call-template&gt;&#13;
            &lt;/title&gt;&#13;
            &lt;remainder-of-title&gt;&#13;
            &lt;xsl:text&gt; : &lt;/xsl:text&gt;&#13;
                &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                &lt;xsl:with-param  name="input" select="oai20:subfield[@code='b']" /&gt;&#13;
                &lt;xsl:with-param  name="characters"&gt;,-./ :;&lt;/xsl:with-param&gt;&#13;
                &lt;/xsl:call-template&gt;&#13;
            &lt;/remainder-of-title&gt;&#13;
            &lt;medium&gt;&#13;
                &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                &lt;xsl:with-param  name="input" select="oai20:subfield[@code='h']" /&gt;&#13;
                &lt;xsl:with-param  name="characters"&gt;,-./ :;&lt;/xsl:with-param&gt;&#13;
                &lt;/xsl:call-template&gt;&#13;
            &lt;/medium&gt;&#13;
            &lt;name-of-part-section-of-work&gt;&#13;
                &lt;xsl:value-of select="oai20:subfield[@code='p']" /&gt;&#13;
            &lt;/name-of-part-section-of-work&gt;&#13;
            &lt;number-of-part-section-of-work&gt;&#13;
                &lt;xsl:value-of select="oai20:subfield[@code='n']" /&gt;&#13;
            &lt;/number-of-part-section-of-work&gt;&#13;
            &lt;inclusive-dates&gt;&#13;
                &lt;xsl:value-of select="oai20:subfield[@code='f']" /&gt;&#13;
            &lt;/inclusive-dates&gt;&#13;
            &lt;/xsl:for-each&gt;&#13;
        &lt;/matchKey&gt;&#13;
    &lt;/xsl:template&gt;&#13;
&#13;
    &lt;xsl:template match="text()"/&gt;&#13;
&#13;
    &lt;xsl:template name="remove-characters-last"&gt;&#13;
        &lt;xsl:param name="input" /&gt;&#13;
        &lt;xsl:param name="characters"/&gt;&#13;
        &lt;xsl:variable name="lastcharacter" select="substring($input,string-length($input))" /&gt;&#13;
        &lt;xsl:choose&gt;&#13;
            &lt;xsl:when test="$characters and $lastcharacter and contains($characters, $lastcharacter)"&gt;&#13;
            &lt;xsl:call-template name="remove-characters-last"&gt;&#13;
                &lt;xsl:with-param  name="input" select="substring($input,1, string-length($input)-1)" /&gt;&#13;
                &lt;xsl:with-param  name="characters" select="$characters" /&gt;&#13;
            &lt;/xsl:call-template&gt;&#13;
            &lt;/xsl:when&gt;&#13;
            &lt;xsl:otherwise&gt;&#13;
            &lt;xsl:value-of select="$input"/&gt;&#13;
            &lt;/xsl:otherwise&gt;&#13;
        &lt;/xsl:choose&gt;&#13;
    &lt;/xsl:template&gt;&#13;
&#13;
&lt;/xsl:stylesheet&gt;&#13;
</script>
    <testData/>
    <testOutput/>
  </XmlTransformStep>
</transformationStep>
