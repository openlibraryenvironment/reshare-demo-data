<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<transformationStep uri="http://harvester.folio-dev-us-east-1-1.folio-dev.indexdata.com/harvester/records/steps/10101">
  <id>301309</id>
  <XmlTransformStep>
    <id>301309</id>
    <description>Transforms from Sirsi Symphony OAI to FOLIO Instance</description>
    <inputFormat>xml</inputFormat>
    <name>Symphony OAI to Instance</name>
    <outputFormat>xml</outputFormat>
    <script>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#xD;
&lt;xsl:stylesheet&#xD;
    version=&quot;1.0&quot;&#xD;
    xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&#xD;
    xmlns:marc=&quot;http://www.loc.gov/MARC21/slim&quot;&#xD;
    xmlns:oai20=&quot;http://www.openarchives.org/OAI/2.0/&quot;&gt;&#xD;
&#xD;
    &lt;xsl:import href=&quot;map-relator-to-contributor-type.xsl&quot;/&gt;&#xD;
    &#xD;
    &lt;xsl:output indent=&quot;yes&quot; method=&quot;xml&quot; version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;/&gt;&#xD;
    &lt;xsl:template match=&quot;/&quot;&gt;&#xD;
        &lt;collection&gt;&#xD;
            &lt;xsl:apply-templates /&gt;&#xD;
        &lt;/collection&gt;&#xD;
    &lt;/xsl:template&gt;&#xD;
&#xD;
    &lt;xsl:template match=&quot;oai20:record&quot;&gt;&#xD;
      &lt;record&gt;&#xD;
        &lt;xsl:choose&gt;&#xD;
          &lt;xsl:when test=&quot;oai20:header[@status=&#39;deleted&#39;]&quot;&gt;&#xD;
             &lt;xsl:apply-templates/&gt;&#xD;
          &lt;/xsl:when&gt;&#xD;
          &lt;xsl:otherwise&gt;  &#xD;
            &lt;!-- Store the original MARC record to be used by subsequent style sheets --&gt;&#xD;
            &lt;original&gt;&#xD;
              &lt;record xmlns=&quot;http://www.openarchives.org/OAI/2.0/&quot; &#xD;
                    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; &#xD;
                    xsi:schemaLocation=&quot;http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd&quot;&gt;&#xD;
                &lt;xsl:for-each select=&quot;@* | node()&quot;&gt;&#xD;
                    &lt;xsl:copy-of select=&quot;.&quot;/&gt;&#xD;
                &lt;/xsl:for-each&gt;&#xD;
              &lt;/record&gt;            &#xD;
            &lt;/original&gt;&#xD;
            &lt;xsl:apply-templates/&gt;&#xD;
          &lt;/xsl:otherwise&gt;&#xD;
        &lt;/xsl:choose&gt;&#xD;
      &lt;/record&gt;&#xD;
    &lt;/xsl:template&gt;&#xD;
&#xD;
&#xD;
    &lt;!-- If this is an OAI-PMH deletion record --&gt;&#xD;
    &lt;xsl:template match=&quot;//oai20:header[@status=&#39;deleted&#39;]&quot;&gt;&#xD;
        &lt;delete&gt;&#xD;
            &lt;oaiIdentifier&gt;&lt;xsl:value-of select=&quot;oai20:identifier&quot;/&gt;&lt;/oaiIdentifier&gt;&#xD;
            &lt;identifierTypeIdHere/&gt;&#xD;
            &lt;institutionIdHere/&gt;&#xD;
        &lt;/delete&gt;&#xD;
    &lt;/xsl:template&gt;&#xD;
&#xD;
    &lt;!-- MARC meta data --&gt;&#xD;
    &lt;xsl:template match=&quot;//marc:record&quot;&gt;&#xD;
&#xD;
        &lt;!-- Information needed for storing source record in union catalog context --&gt;&#xD;
        &lt;institutionIdHere/&gt;&#xD;
        &lt;xsl:variable name=&quot;identifier&quot; select=&quot;substring-after(substring-after(../../oai20:header/oai20:identifier, &#39;:&#39;), &#39;:&#39;)&quot;/&gt;&#xD;
        &lt;localIdentifier&gt;&lt;xsl:value-of select=&quot;$identifier&quot; /&gt;&lt;/localIdentifier&gt;&#xD;
&#xD;
        &lt;processing&gt;&#xD;
            &lt;identifierTypeIdHere/&gt;&#xD;
            &lt;localIdentifier&gt;&lt;xsl:value-of select="$identifier" /&gt;&lt;/localIdentifier&gt;&#xD;
            &lt;institutionIdHere/&gt;&#xD;
        &lt;/processing&gt;&#xD;
&#xD;
        &lt;!-- Bibliographic record for FOLIO inventory --&gt;&#xD;
        &lt;instance&gt;&#xD;
            &lt;source&gt;MARC&lt;/source&gt;&#xD;
&#xD;
            &lt;!-- Instance type ID (resource type) --&gt;&#xD;
            &lt;instanceTypeId&gt;&#xD;
                &lt;!-- UUIDs for resource types --&gt;&#xD;
                &lt;xsl:choose&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;a&#39;&quot;&gt;6312d172-f0cf-40f6-b27d-9fa8feaf332f&lt;/xsl:when&gt; &lt;!-- language material : text --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;c&#39;&quot;&gt;497b5090-3da2-486c-b57f-de5bb3c2e26d&lt;/xsl:when&gt; &lt;!-- notated music : notated music --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;d&#39;&quot;&gt;497b5090-3da2-486c-b57f-de5bb3c2e26d&lt;/xsl:when&gt; &lt;!-- manuscript notated music : notated music -&gt; notated music --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;e&#39;&quot;&gt;526aa04d-9289-4511-8866-349299592c18&lt;/xsl:when&gt; &lt;!-- cartographic material : cartographic image --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;f&#39;&quot;&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- other --&gt; &lt;!-- manuscript cartographic material : ? --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;g&#39;&quot;&gt;535e3160-763a-42f9-b0c0-d8ed7df6e2a2&lt;/xsl:when&gt; &lt;!-- projected image : still image --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;i&#39;&quot;&gt;9bce18bd-45bf-4949-8fa8-63163e4b7d7f&lt;/xsl:when&gt; &lt;!-- nonmusical sound recording : sounds --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;j&#39;&quot;&gt;3be24c14-3551-4180-9292-26a786649c8b&lt;/xsl:when&gt; &lt;!-- musical sound recording : performed music --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;k&#39;&quot;&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- other --&gt; &lt;!-- two-dimensional nonprojectable graphic : ?--&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;m&#39;&quot;&gt;df5dddff-9c30-4507-8b82-119ff972d4d7&lt;/xsl:when&gt; &lt;!-- computer file : computer dataset --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;o&#39;&quot;&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- kit : other --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;p&#39;&quot;&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:when&gt; &lt;!-- mixed material : other --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;r&#39;&quot;&gt;c1e95c2b-4efc-48cf-9e71-edb622cf0c22&lt;/xsl:when&gt; &lt;!-- three-dimensional artifact or naturally occurring object : three-dimensional form --&gt;&#xD;
                &lt;xsl:when test=&quot;substring(marc:leader,7,1)=&#39;t&#39;&quot;&gt;6312d172-f0cf-40f6-b27d-9fa8feaf332f&lt;/xsl:when&gt; &lt;!-- manuscript language material : text --&gt;&#xD;
                &lt;xsl:otherwise&gt;a2c91e87-6bab-44d6-8adb-1fd02481fc4f&lt;/xsl:otherwise&gt;                             &lt;!--  : other --&gt;&#xD;
                &lt;/xsl:choose&gt;&#xD;
            &lt;/instanceTypeId&gt;&#xD;
&#xD;
            &lt;!-- Identifiers --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;010&#39; or @tag=&#39;020&#39; or @tag=&#39;022&#39; or @tag=&#39;024&#39; or @tag=&#39;028&#39; or @tag=&#39;035&#39; or @tag=&#39;074&#39;]&#xD;
                        or marc:controlfield[@tag=&#39;001&#39;]&quot;&gt;&#xD;
                &lt;identifiers&gt;&#xD;
                &lt;arr&gt;&#xD;
                    &lt;i&gt;&#xD;
                    &lt;value&gt;&lt;xsl:value-of select=&quot;$identifier&quot;/&gt;&lt;/value&gt;&#xD;
                    &lt;!-- A subsequent library specific transformation (style sheet)&#xD;
                        must replace this tag with the actual identifierTypeId for&#xD;
                        the record identifer type of the given library --&gt;&#xD;
                    &lt;identifierTypeIdHere/&gt;&#xD;
                    &lt;/i&gt;&#xD;
                &lt;xsl:for-each select=&quot;marc:datafield[(@tag=&#39;001&#39; or @tag=&#39;010&#39; or @tag=&#39;020&#39; or @tag=&#39;022&#39; or @tag=&#39;024&#39; or @tag=&#39;028&#39; or @tag=&#39;035&#39; or @tag=&#39;074&#39;) and normalize-space(./marc:subfield[@code=&#39;a&#39;])]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                    &lt;xsl:choose&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;010&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;c858e4f2-2b6b-4385-842b-60732ee14abb&lt;/identifierTypeId&gt; &lt;!-- LCCN --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;020&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;8261054f-be78-422d-bd51-4ed9f33c3422&lt;/identifierTypeId&gt; &lt;!-- ISBN --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;022&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;913300b2-03ed-469a-8179-c1092c991227&lt;/identifierTypeId&gt; &lt;!-- ISSN --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;024&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;2e8b3b6c-0e7d-4e48-bca2-b0b23b376af5&lt;/identifierTypeId&gt; &lt;!-- Other standard identifier --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;028&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;b5d8cdc4-9441-487c-90cf-0c7ec97728eb&lt;/identifierTypeId&gt; &lt;!-- Publisher number --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;035&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;7e591197-f335-4afb-bc6d-a6d76ca3bace&lt;/identifierTypeId&gt; &lt;!-- System control number --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;074&#39;] and marc:subfield[@code=&#39;a&#39;]&quot;&gt;&#xD;
                        &lt;value&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/value&gt;&#xD;
                        &lt;identifierTypeId&gt;351ebc1c-3aae-4825-8765-c6d50dbf011f&lt;/identifierTypeId&gt; &lt;!-- GPO item number --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                    &lt;/xsl:choose&gt;&#xD;
                    &lt;/i&gt;&#xD;
                &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/identifiers&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- Classifications --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;050&#39; or @tag=&#39;060&#39; or @tag=&#39;080&#39; or @tag=&#39;082&#39; or @tag=&#39;086&#39; or @tag=&#39;090&#39;]&quot;&gt;&#xD;
                &lt;classifications&gt;&#xD;
                &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;050&#39; or @tag=&#39;060&#39; or @tag=&#39;080&#39; or @tag=&#39;082&#39; or @tag=&#39;086&#39; or @tag=&#39;090&#39;]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                        &lt;xsl:choose&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;050&#39;]&quot;&gt;&#xD;
                            &lt;classificationNumber&gt;&#xD;
                            &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39;]&quot;&gt;&#xD;
                                &lt;xsl:if test=&quot;position() &gt; 1&quot;&gt;&#xD;
                                &lt;xsl:text&gt;; &lt;/xsl:text&gt;&#xD;
                            &lt;/xsl:if&gt;&#xD;
                            &lt;xsl:value-of select=&quot;.&quot;/&gt;&#xD;
                            &lt;/xsl:for-each&gt;&#xD;
                            &lt;/classificationNumber&gt;&#xD;
                            &lt;classificationTypeId&gt;ce176ace-a53e-4b4d-aa89-725ed7b2edac&lt;/classificationTypeId&gt; &lt;!-- LC, Library of Congress --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;082&#39;]&quot;&gt;&#xD;
                            &lt;classificationNumber&gt;&#xD;
                            &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39;]&quot;&gt;&#xD;
                                &lt;xsl:if test=&quot;position() &gt; 1&quot;&gt;&#xD;
                                &lt;xsl:text&gt;; &lt;/xsl:text&gt;&#xD;
                            &lt;/xsl:if&gt;&#xD;
                            &lt;xsl:value-of select=&quot;.&quot;/&gt;&#xD;
                            &lt;/xsl:for-each&gt;&#xD;
                            &lt;/classificationNumber&gt;&#xD;
                            &lt;classificationTypeId&gt;42471af9-7d25-4f3a-bf78-60d29dcf463b&lt;/classificationTypeId&gt; &lt;!-- Dewey --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;current()[@tag=&#39;086&#39;]&quot;&gt;&#xD;
                            &lt;classificationNumber&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                            &lt;/classificationNumber&gt;&#xD;
                            &lt;classificationTypeId&gt;9075b5f8-7d97-49e1-a431-73fdd468d476&lt;/classificationTypeId&gt; &lt;!-- SUDOC --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;/xsl:choose&gt;&#xD;
                    &lt;/i&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/classifications&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- title --&gt; &#xD;
            &lt;title&gt;&#xD;
                &lt;xsl:variable name=&quot;dirty-title&quot;&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;245&#39;][1]/marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;h&#39; or @code=&#39;n&#39; or @code=&#39;p&#39;]&quot;&gt;&#xD;
                        &lt;xsl:value-of select=&quot;.&quot;/&gt;&#xD;
                        &lt;xsl:if test=&quot;position() != last()&quot;&gt;&#xD;
                            &lt;xsl:text&gt; &lt;/xsl:text&gt;&#xD;
                        &lt;/xsl:if&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                &lt;/xsl:variable&gt;&#xD;
                &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                    &lt;xsl:with-param  name=&quot;input&quot; select=&quot;$dirty-title&quot; /&gt;&#xD;
                    &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-./ :;&lt;/xsl:with-param&gt;&#xD;
                &lt;/xsl:call-template&gt;&#xD;
            &lt;/title&gt;&#xD;
&#xD;
            &lt;!-- Contributors --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;100&#39; or @tag=&#39;110&#39; or @tag=&#39;111&#39; or @tag=&#39;700&#39; or @tag=&#39;710&#39; or @tag=&#39;711&#39;]&quot;&gt;&#xD;
                &lt;contributors&gt;&#xD;
                &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;100&#39; or @tag=&#39;110&#39; or @tag=&#39;111&#39; or @tag=&#39;700&#39; or @tag=&#39;710&#39; or @tag=&#39;711&#39;]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                        &lt;name&gt;&#xD;
                        &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;c&#39; or @code=&#39;d&#39; or @code=&#39;f&#39; or @code=&#39;g&#39; or @code=&#39;j&#39; or @code=&#39;k&#39; or @code=&#39;l&#39; or @code=&#39;n&#39; or @code=&#39;p&#39; or @code=&#39;q&#39; or @code=&#39;t&#39; or @code=&#39;u&#39;]&quot;&gt;&#xD;
                        &lt;xsl:if test=&quot;position() &gt; 1&quot;&gt;&#xD;
                            &lt;xsl:text&gt;, &lt;/xsl:text&gt;&#xD;
                        &lt;/xsl:if&gt;&#xD;
                        &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                            &lt;xsl:with-param  name=&quot;input&quot; select=&quot;.&quot; /&gt;&#xD;
                            &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-.&lt;/xsl:with-param&gt;&#xD;
                        &lt;/xsl:call-template&gt;&#xD;
                        &lt;/xsl:for-each&gt;&#xD;
                        &lt;/name&gt;&#xD;
                        &lt;xsl:choose&gt;&#xD;
                        &lt;xsl:when test=&quot;@tag=&#39;100&#39; or @tag=&#39;700&#39;&quot;&gt;&#xD;
                            &lt;contributorNameTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe2a&lt;/contributorNameTypeId&gt; &lt;!-- personal name --&gt;&#xD;
                            &lt;xsl:if test=&quot;@tag=&#39;100&#39;&quot;&gt;&#xD;
                            &lt;primary&gt;true&lt;/primary&gt;&#xD;
                            &lt;/xsl:if&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;@tag=&#39;110&#39; or @tag=&#39;710&#39;&quot;&gt;&#xD;
                            &lt;contributorNameTypeId&gt;2e48e713-17f3-4c13-a9f8-23845bb210aa&lt;/contributorNameTypeId&gt; &lt;!-- corporate name --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:when test=&quot;@tag=&#39;111&#39; or @tage=&#39;711&#39;&quot;&gt;&#xD;
                            &lt;contributorNameTypeId&gt;e8b311a6-3b21-43f2-a269-dd9310cb2d0a&lt;/contributorNameTypeId&gt; &lt;!-- meeting name --&gt;&#xD;
                        &lt;/xsl:when&gt;&#xD;
                        &lt;xsl:otherwise&gt;&#xD;
                            &lt;contributorNameTypeId&gt;2b94c631-fca9-4892-a730-03ee529ffe2a&lt;/contributorNameTypeId&gt; &lt;!-- personal name --&gt;&#xD;
                        &lt;/xsl:otherwise&gt;&#xD;
                        &lt;/xsl:choose&gt;&#xD;
                        &lt;xsl:if test=&quot;marc:subfield[@code=&#39;e&#39; or @code=&#39;4&#39;]&quot;&gt;&#xD;
                        &lt;contributorTypeId&gt;&#xD;
                            &lt;xsl:call-template name=&quot;map-relator&quot;/&gt;&#xD;
                        &lt;/contributorTypeId&gt;&#xD;
                        &lt;/xsl:if&gt;&#xD;
                    &lt;/i&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/contributors&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- Editions --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;250&#39;]&quot;&gt;&#xD;
                &lt;editions&gt;&#xD;
                &lt;arr&gt;&#xD;
                &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;250&#39;]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                    &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                    &lt;xsl:if test=&quot;marc:subfield[@code=&#39;b&#39;]&quot;&gt;; &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;/&gt;&lt;/xsl:if&gt;&#xD;
                    &lt;/i&gt;&#xD;
                &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/editions&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- Publication --&gt;&#xD;
            &lt;xsl:choose&gt;&#xD;
                &lt;xsl:when test=&quot;marc:datafield[@tag=&#39;260&#39; or @tag=&#39;264&#39;]&quot;&gt;&#xD;
                &lt;publication&gt;&#xD;
                    &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;260&#39; or @tag=&#39;264&#39;]&quot;&gt;&#xD;
                        &lt;i&gt;&#xD;
                        &lt;publisher&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;b&#39;]&quot;/&gt;&#xD;
                        &lt;/publisher&gt;&#xD;
                        &lt;place&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;a&#39;]&quot;/&gt;&#xD;
                        &lt;/place&gt;&#xD;
                        &lt;dateOfPublication&gt;&#xD;
                            &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;c&#39;]&quot;/&gt;&#xD;
                        &lt;/dateOfPublication&gt;&#xD;
                        &lt;/i&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                    &lt;/arr&gt;&#xD;
                &lt;/publication&gt;&#xD;
                &lt;/xsl:when&gt;&#xD;
                &lt;xsl:otherwise&gt;&#xD;
                &lt;publication&gt;&#xD;
                    &lt;arr&gt;&#xD;
                    &lt;i&gt;&#xD;
                        &lt;dateOfPublication&gt;&#xD;
                        &lt;xsl:value-of select=&quot;substring(marc:controlfield[@tag=&#39;008&#39;],8,4)&quot;/&gt;&#xD;
                        &lt;/dateOfPublication&gt;&#xD;
                    &lt;/i&gt;&#xD;
                    &lt;/arr&gt;&#xD;
                &lt;/publication&gt;&#xD;
                &lt;/xsl:otherwise&gt;&#xD;
            &lt;/xsl:choose&gt;&#xD;
&#xD;
            &lt;!-- physicalDescriptions --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;300&#39;]&quot;&gt;&#xD;
                &lt;physicalDescriptions&gt;&#xD;
                &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;300&#39;]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                        &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                        &lt;xsl:with-param  name=&quot;input&quot; select=&quot;marc:subfield[@code=&#39;a&#39;]&quot; /&gt;&#xD;
                        &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-./ :;&lt;/xsl:with-param&gt;&#xD;
                        &lt;/xsl:call-template&gt;&#xD;
                    &lt;/i&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/physicalDescriptions&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- Subjects --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;600&#39; or @tag=&#39;610&#39; or @tag=&#39;611&#39; or @tag=&#39;630&#39; or @tag=&#39;648&#39; or @tag=&#39;650&#39; or @tag=&#39;651&#39; or @tag=&#39;653&#39; or @tag=&#39;654&#39; or @tag=&#39;655&#39; or @tag=&#39;656&#39; or @tag=&#39;657&#39; or @tag=&#39;658&#39; or @tag=&#39;662&#39; or @tag=&#39;69X&#39;]&quot;&gt;&#xD;
                &lt;subjects&gt;&#xD;
                &lt;arr&gt;&#xD;
                &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;600&#39; or @tag=&#39;610&#39; or @tag=&#39;611&#39; or @tag=&#39;630&#39; or @tag=&#39;648&#39; or @tag=&#39;650&#39; or @tag=&#39;651&#39; or @tag=&#39;653&#39; or @tag=&#39;654&#39; or @tag=&#39;655&#39; or @tag=&#39;656&#39; or @tag=&#39;657&#39; or @tag=&#39;658&#39; or @tag=&#39;662&#39; or @tag=&#39;69X&#39;]&quot;&gt;&#xD;
                    &lt;i&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:subfield[@code=&#39;a&#39; or @code=&#39;b&#39; or @code=&#39;c&#39; or @code=&#39;d&#39; or @code=&#39;f&#39; or @code=&#39;g&#39; or @code=&#39;j&#39; or @code=&#39;k&#39; or @code=&#39;l&#39; or @code=&#39;n&#39; or @code=&#39;p&#39; or @code=&#39;q&#39; or @code=&#39;t&#39; or @code=&#39;u&#39; or @code=&#39;v&#39; or @code=&#39;x&#39; or @code=&#39;y&#39; or @code=&#39;z&#39;]&quot;&gt;&#xD;
                    &lt;xsl:if test=&quot;position() &gt; 1&quot;&gt;&#xD;
                        &lt;xsl:text&gt;--&lt;/xsl:text&gt;&#xD;
                    &lt;/xsl:if&gt;&#xD;
                    &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                        &lt;xsl:with-param  name=&quot;input&quot; select=&quot;.&quot; /&gt;&#xD;
                        &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-.&lt;/xsl:with-param&gt;&#xD;
                        &lt;/xsl:call-template&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                    &lt;/i&gt;&#xD;
                &lt;/xsl:for-each&gt;&#xD;
                &lt;/arr&gt;&#xD;
                &lt;/subjects&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
&#xD;
            &lt;!-- Notes --&gt;&#xD;
            &lt;xsl:if test=&quot;marc:datafield[@tag=&#39;500&#39; or @tag=&#39;504&#39; or @tag=&#39;505&#39; or @tag=&#39;520&#39;]&quot;&gt;&#xD;
                &lt;notes&gt;&#xD;
                    &lt;arr&gt;&#xD;
                    &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;500&#39; or @tag=&#39;504&#39; or @tag=&#39;505&#39; or @tag=&#39;520&#39;]&quot;&gt;&#xD;
                        &lt;i&gt;&#xD;
                            &lt;note&gt;&#xD;
                                &lt;xsl:value-of select=&quot;normalize-space(.)&quot;/&gt;&#xD;
                            &lt;/note&gt;&#xD;
                            &lt;instanceNoteTypeId&gt;&#xD;
                                &lt;xsl:choose&gt;&#xD;
                                    &lt;xsl:when test=&#39;./@tag=&quot;504&quot;&#39;&gt;86b6e817-e1bc-42fb-bab0-70e7547de6c1&lt;/xsl:when&gt; &lt;!-- biliography --&gt;&#xD;
                                    &lt;xsl:when test=&#39;./@tag=&quot;505&quot;&#39;&gt;5ba8e385-0e27-462e-a571-ffa1fa34ea54&lt;/xsl:when&gt; &lt;!-- contents --&gt;&#xD;
                                    &lt;xsl:when test=&#39;./@tag=&quot;520&quot;&#39;&gt;0e2e11b-450f-45c8-b09b-0f819999966e&lt;/xsl:when&gt; &lt;!-- contents --&gt;&#xD;
                                    &lt;xsl:otherwise&gt;6a2533a7-4de2-4e64-8466-074c2fa9308c&lt;/xsl:otherwise&gt; &lt;!-- general --&gt;&#xD;
                            &lt;/xsl:choose&gt;&#xD;
                            &lt;/instanceNoteTypeId&gt;&#xD;
                        &lt;/i&gt;&#xD;
                    &lt;/xsl:for-each&gt;&#xD;
                    &lt;/arr&gt;&#xD;
                &lt;/notes&gt;&#xD;
            &lt;/xsl:if&gt;&#xD;
            &#xD;
        &lt;/instance&gt;&#xD;
&#xD;
        &lt;!-- Additional info for creating match key in FOLIO Inventory match module --&gt;&#xD;
        &lt;matchKey&gt;&#xD;
            &lt;xsl:for-each select=&quot;marc:datafield[@tag=&#39;245&#39;]&quot;&gt;&#xD;
            &lt;title&gt;&#xD;
                &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                &lt;xsl:with-param  name=&quot;input&quot; select=&quot;marc:subfield[@code=&#39;a&#39;]&quot; /&gt;&#xD;
                &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-./ :;&lt;/xsl:with-param&gt;&#xD;
                &lt;/xsl:call-template&gt;&#xD;
            &lt;/title&gt;&#xD;
            &lt;remainder-of-title&gt;&#xD;
            &lt;xsl:text&gt; : &lt;/xsl:text&gt;&#xD;
                &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                &lt;xsl:with-param  name=&quot;input&quot; select=&quot;marc:subfield[@code=&#39;b&#39;]&quot; /&gt;&#xD;
                &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-./ :;&lt;/xsl:with-param&gt;&#xD;
                &lt;/xsl:call-template&gt;&#xD;
            &lt;/remainder-of-title&gt;&#xD;
            &lt;medium&gt;&#xD;
                &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                &lt;xsl:with-param  name=&quot;input&quot; select=&quot;marc:subfield[@code=&#39;h&#39;]&quot; /&gt;&#xD;
                &lt;xsl:with-param  name=&quot;characters&quot;&gt;,-./ :;&lt;/xsl:with-param&gt;&#xD;
                &lt;/xsl:call-template&gt;&#xD;
            &lt;/medium&gt;&#xD;
            &lt;name-of-part-section-of-work&gt;&#xD;
                &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;p&#39;]&quot; /&gt;&#xD;
            &lt;/name-of-part-section-of-work&gt;&#xD;
            &lt;number-of-part-section-of-work&gt;&#xD;
                &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;n&#39;]&quot; /&gt;&#xD;
            &lt;/number-of-part-section-of-work&gt;&#xD;
            &lt;inclusive-dates&gt;&#xD;
                &lt;xsl:value-of select=&quot;marc:subfield[@code=&#39;f&#39;]&quot; /&gt;&#xD;
            &lt;/inclusive-dates&gt;&#xD;
            &lt;/xsl:for-each&gt;&#xD;
        &lt;/matchKey&gt;&#xD;
    &lt;/xsl:template&gt;&#xD;
&#xD;
    &lt;xsl:template match=&quot;text()&quot;/&gt;&#xD;
&#xD;
    &lt;xsl:template name=&quot;remove-characters-last&quot;&gt;&#xD;
        &lt;xsl:param name=&quot;input&quot; /&gt;&#xD;
        &lt;xsl:param name=&quot;characters&quot;/&gt;&#xD;
        &lt;xsl:variable name=&quot;lastcharacter&quot; select=&quot;substring($input,string-length($input))&quot; /&gt;&#xD;
        &lt;xsl:choose&gt;&#xD;
            &lt;xsl:when test=&quot;$characters and $lastcharacter and contains($characters, $lastcharacter)&quot;&gt;&#xD;
            &lt;xsl:call-template name=&quot;remove-characters-last&quot;&gt;&#xD;
                &lt;xsl:with-param  name=&quot;input&quot; select=&quot;substring($input,1, string-length($input)-1)&quot; /&gt;&#xD;
                &lt;xsl:with-param  name=&quot;characters&quot; select=&quot;$characters&quot; /&gt;&#xD;
            &lt;/xsl:call-template&gt;&#xD;
            &lt;/xsl:when&gt;&#xD;
            &lt;xsl:otherwise&gt;&#xD;
            &lt;xsl:value-of select=&quot;$input&quot;/&gt;&#xD;
            &lt;/xsl:otherwise&gt;&#xD;
        &lt;/xsl:choose&gt;&#xD;
    &lt;/xsl:template&gt;&#xD;
&#xD;
&lt;/xsl:stylesheet&gt;&#xD;
</script>
    <testData/>
    <testOutput/>
  </XmlTransformStep>
</transformationStep>
